'From Croquet1.0beta of 11 April 2006 [latest update: #1] on 22 December 2009 at 10:57:19 am'!!QSessionCapturePane methodsFor: 'recording' stamp: 'jcg 12/19/2009 10:27'!stopRecording	"Finish recording the session"	self isRecording ifFalse:[^self].	self stopGlobalAudioRecording.	self stopChatCapture.	self stopVoiceCapture.	self stopVideoCapture.	self stopEncoding.	self stopPublishing.	allTracks := IdentityDictionary new.! !!QSessionCapturePane methodsFor: 'private' stamp: 'jcg 12/19/2009 10:17'!stopGlobalAudioRecording	self subclassResponsibility ! !!QSessionBroadcasterPane methodsFor: 'private' stamp: 'jcg 12/19/2009 10:18'!stopGlobalAudioRecording	"Only turn off audio recording if the session-recorder pane isn't using it."	owner recorderPane isRecording ifFalse: [		owner audioSession isRecordingSession: false.	].! !!QSessionRecorderPane methodsFor: 'private' stamp: 'jcg 12/19/2009 10:18'!stopGlobalAudioRecording	"Only turn off audio recording if the webcast pane isn't using it."	owner broadcastPane isRecording ifFalse: [		owner audioSession isRecordingSession: false.	].! !!QwaqParticipantUI methodsFor: 'render' stamp: 'bgf 12/20/2009 14:11'!updateCostume: aCostume	"Update the damage rectangles for the given costume"	| box formCache material rectList bb |	aCostume visible ifFalse:[^self].	box := aCostume drawingBounds.	box := box origin asIntegerPoint corner: box corner asIntegerPoint.	formCache := aCostume localCache.	(formCache isKindOf: QTextureFormCache) 		ifFalse:[aCostume localCache: (formCache := QTextureFormCache new)].	"figure out changes in size/depth"	(formCache form == nil 		or:[formCache form extent isPowerOfTwo not			or:[formCache form extent asLargerPowerOfTwo ~= box extent asLargerPowerOfTwo]]) ifTrue:[		formCache form: (Form extent: box extent asLargerPowerOfTwo depth: 32).	].	"repair damage"	rectList := formCache 		repairDamage: aCostume drawingBounds 		using:[:cc| aCostume localFullDrawOn: cc].	"grab the texture cache"	material := formCache material.	"make sure it hasn't changed"	(material == nil or:[material textureForm ~~ formCache form]) ifTrue:[		"Try to prevent async changes (?) from leading to MNU UndefinedObject extent:   	 	 apparently from loss/destruction of costume localCache.		 The error appears to arise during device-change-induced sound-resets,		 but the transcripts I've seen give little else to go on."		formCache = (aCostume localCache) ifFalse: [ 			QLogger logWarning: 'Costume cache lost during update.' every: 60000.			^ self ].		formCache form ifNotNilDo: [ : f | 			material := TMaterial new.			material useForm: f mipmap: false  shrinkFit: true.			material texture invalidate: f boundingBox.			formCache material: material.		] ifNil: [ 			QLogger logWarning: 'Costume cache form lost during update.' every: 60000.			^ self 		]].	"fix up alpha and remember upload rectangle"	bb := BitBlt toForm: material textureForm.	bb combinationRule: 40 "fixAlpha:with:".	bb halftoneForm: (Bitmap with: 16rFF000000).	rectList do:[:r|		| aRect |		aRect := r translateBy: box origin negated.		bb destRect: aRect.		bb copyBits.		material texture invalidate: aRect.	].! !