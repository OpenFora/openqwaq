#summary One-Detailed installation instructions for enabling secure SSL login to OQ Admin pages.

= Introduction =

It's best to login to the OpenQwaq Admin pages using the secure HTTPS protocol. I took a stab at this and have been able to get it to work a couple times by following the directions verbatim (copy-and-paste recommended!). 

Notes:
-- cobbled together from various sources, including Ron T. and Patrick (thanks to both)
-- this is an alternative to a Verisign-type certificate, saving you $$$
-- your firewall needs to open up port 8443 for this to work
-- the browser will bark at you for the self-signed key but since it's just your own admin pages your customers won't see it so shouldn't be a problem
-- copy-and-paste the lines that don't have the # comment symbol

Feel free to try it out and let me know if there's any issues or typos.

Good luck!

Mark Loparco
09.16.2011


= Details =

# 0. gain root access to your server
# ==================================
# depends on how your server and ssh login works:
# can either be password-less root login (not recommended)
# or login as openqwaq and "sudo su" to root (saves sudo-ing the commands)

# 1. install prerequisite components
# ==================================
# these may already be installed from step 1 of the OQ installation instructions, but just in case:
yum install mod_ssl
yum install openssl

# 2. enable https connections
# ===========================
# make a symbolic link to the OpenQwaq-https.conf file
ln -s /home/openqwaq/server/etc/OpenQwaq-https.conf /etc/httpd/conf.d/OpenQwaq-https.conf
# edit the OpenQwaq-https.conf file
vi /home/openqwaq/server/etc/OpenQwaq-https.conf
# change the ServerName from openqwaq.openqwaq.org to YOUR_SERVER_NAME or YOUR_SERVER_IP
# change "loadlhost" typo in file (not sure if needed but why not?):
# change "Allow from loadlhost.localdomain" to "Allow from localhost.localdomain"
# make sure that the # SSL cert/key line within <VirtualHost *:8443> reads:
# SSLCertificateFile /home/openqwaq/server/etc/keys/openqwaq.com.crt
# SSLCertificateKeyFile /home/openqwaq/server/etc/keys/openqwaq.com.key.insecure
# note: these file names must match those created in Step #4 below

# 3. generate the necessary keys and certificates
# ===============================================
# navigate to keys directory (not necessary to be in this directory but I like to work here)
cd /home/openqwaq/server/etc/keys
# generate private key
openssl genrsa -out ca.key 1024 
# note: when I used 4096 it didn't work, perhaps for 32-bit reasons (?)

# generate Certificate Signing Request (CSR)
openssl req -new -key ca.key -out ca.csr

# generate self-signed key
openssl x509 -req -days 365 -in ca.csr -signkey ca.key -out ca.crt

# 4. copy the files to correct location
# =====================================
cp ca.crt /home/openqwaq/server/etc/keys/openqwaq.com.crt
cp ca.key /home/openqwaq/server/etc/keys/openqwaq.com.key.insecure

# 5. set admin username and password to what you want
# ===================================================
# option a: create a new user and assign password
htdigest /home/openqwaq/server/etc/OpenQwaq-digests 'OpenQwaq Server Admin Pages' someNewUserName
# you will be prompted to enter and confirm the password
# option b: change the password on an existing user
htpasswd /home/openqwaq/server/etc/OpenQwaq-digests someExistingUserName
# you will be prompted to enter and confirm the password

# 6. restart apache
/etc/init.d/httpd restart

# 7. test it out by going to the admin web page - note to type https and port number
https://YOUR_IP:8443/admin/
# enter username and password and hopefully you're in!
